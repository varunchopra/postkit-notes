{% extends "base.html" %}

{% block title %}New API Key{% endblock %}

{% block content %}
<div class="page-header">
    <h1>New API Key</h1>
    <a href="{{ url_for('views.dashboard.api_keys') }}" class="btn">Cancel</a>
</div>

<form method="POST" action="{{ url_for('views.dashboard.create_api_key') }}">
    <div class="section">
        <div class="section-header">
            <h2>Token Details</h2>
        </div>

        <div class="form-group">
            <label for="name">What's this token for?</label>
            <input type="text" id="name" name="name" placeholder="e.g., CI/CD Pipeline, Mobile App" maxlength="64" required>
            <div class="form-help">A short description to identify this token</div>
        </div>

        <div class="form-group">
            <label for="expires_in_days">Expiration</label>
            <select id="expires_in_days" name="expires_in_days">
                <option value="7">7 days</option>
                <option value="30" selected>30 days</option>
                <option value="60">60 days</option>
                <option value="90">90 days</option>
                <option value="365">1 year</option>
            </select>
        </div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>Permissions</h2>
        </div>
        <p class="section-description">Select the access level for this token. The token can only access resources you have permission to access.</p>

        <div class="permission-section">
            <h3>Notes</h3>
            <div class="permission-options">
                <label class="permission-option">
                    <input type="radio" name="notes_access" value="none" checked>
                    <div class="option-content">
                        <strong>No access</strong>
                        <span class="option-desc">Cannot access notes via API</span>
                    </div>
                </label>

                <label class="permission-option">
                    <input type="radio" name="notes_access" value="all">
                    <div class="option-content">
                        <strong>All notes</strong>
                        <span class="option-desc">Access all notes you have permission to view</span>
                    </div>
                </label>

                {% if notes %}
                <label class="permission-option">
                    <input type="radio" name="notes_access" value="selected">
                    <div class="option-content">
                        <strong>Only select notes</strong>
                        <span class="option-desc">Choose specific notes to grant access to</span>
                    </div>
                </label>
                {% endif %}
            </div>

            <div id="notes-level-section" class="access-level-section d-none">
                <label for="notes_level">Access level:</label>
                <select id="notes_level" name="notes_level">
                    <option value="read">Read-only</option>
                    <option value="write">Read and write</option>
                    <option value="admin">Admin (full control)</option>
                </select>
            </div>

            {% if notes %}
            <div id="notes-selection" class="resource-selection d-none">
                <label>Select notes:</label>
                <div class="checkbox-list">
                    {% for note in notes %}
                    <label class="checkbox-item">
                        <input type="checkbox" name="selected_notes" value="{{ note.note_id }}">
                        <span>{{ note.title or 'Untitled' }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Generate token</button>
    </div>
</form>
{% endblock %}
